{% extends 'base.html.twig' %}

{% set conProceso = 0 %}
{% set conPendiente = 0 %}
{% set conAprobado = 0  %}
{% set conRechazado = 0  %}
{% set conTransito = 0  %}
{% set conFinalizado = 0  %}
{% set conEspera = 0  %}

{% for orden in ordenes %}
    {% if orden.estado == 0 %}
      {% set conProceso =+1  %}

    {% elseif orden.estado == 1 %}
      {% set conPendiente = conPendiente +1  %}

    {% elseif orden.estado == 2 %}
      {% set conAprobado = conAprobado +1  %}

    {% elseif orden.estado == 3 %}
      {% set conRechazado = conRechazado +1  %}

    {% elseif orden.estado == 4 %}
      {% set conTransito = conTransito +1  %}

    {% elseif orden.estado == 5 %}
      {% set conFinalizado = conFinalizado +1  %}

    {% elseif orden.estado == 6 %}
      {% set conEspera = conEspera +1  %}
      {% endif %}
{% endfor %}

{% block body %}

    <script>
        $(document).ready(function(){

            $("* .detalle").click(function(){
                var a = $(this).attr('id');
                window.location.href = "/entr_linea/"+a+"";
            })

        });
    </script>

    <style>
        .btnC{width:134px;
              font-size:15px;}

        .btnA{width:68px;
              font-size: 12px;}

        .bot{float: left;
            clear: left;}

        .detalle, .imp{display:none;
                            cursor:pointer;}
          .impNeg{visibility:hidden;}

        tr:hover .detalle{ display:block; }
        tr:hover .imp{ display:block; }

    </style>

 <div class="container  ">


     <br>
     <!-- ./Tabs -->
     <section id="tabs">

         <h6 class="section-title h1" style="float:left;">Gestión de ordenes</h6>

         <br>
         <br>
         <br>
         <br>

         <div class="row">

             <div class="col-lg-12 ">

                 <nav >

                     <!-------------------------- titulos de tabs ---------------------->
                     <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist" >
                         <a class="nav-item nav-link" id="nav-recepcion-tab"  href="ordenes" role="tab" aria-controls="nav-recepcion" aria-selected="true" >Ordenes de recepción</a>
                         <a class="nav-item nav-link active" id="nav-envio-tab" data-toggle="tab" href="nav-envio" role="tab" aria-controls="nav-envio" aria-selected="false" >Ordenes de entrega</a>
                       </div>
                 </nav>

                 <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent" >


                     <!-------------------------- tab 1 ---------------------->

                     <div class="tab-pane fade " id="nav-recepcion" role="tabpanel" aria-labelledby="nav-rcepcion-tab" >

                         <div class="alert alert-info" role="alert">
                             <div style="float:left; margin-right:50px;">Pendientes <span class="badge badge-danger">{{ conPendiente }}  </span></div>
                            <div></div>
                             <div style="">En proceso <span class="badge badge-secondary">{{ conProceso }} </span></div>
                             <div style="">Rechazado <span class="badge badge-secondary">{{ conRechazado }} </span></div>
                             <div style="">En tránsito <span class="badge badge-secondary">{{ conTransito }} </span></div>
                             <div style="">Finalizado <span class="badge badge-secondary">{{ conFinalizado }} </span></div>
                             <div style="">Aprobado <span class="badge badge-secondary">{{ conAprobado }} </span></div>
                         </div>
                        <br>

                     </div>

                     <!-------------------------- tab 2 ---------------------->
                     <div class="tab-pane fade show active" id="nav-envio" role="tabpanel" aria-labelledby="nav-envio-tab">
                       <br>
                          <section class="row">

                            <!---------------------------------->
                            <section class="boxCuadro row">
                                <div class="cuadrado" style="background:rgb(31, 208, 233);">
                                    <img src="imagenes/proceso.png">
                                </div>

                                <section class="cuadradoTexto">
                                  <div>{{ conProceso }}</div>
                                  <div style="font-size:10px;">En proceso</div>
                                </section>
                            </section>

                            <!---------------------------------->

                            <section class="boxCuadro row">
                                <div class="cuadrado " style="background:rgb(238, 109, 105);">
                                    <img src="imagenes/pendiente.png">
                                </div>

                                <section class="cuadradoTexto">
                                  <div>{{ conPendiente }}</div>
                                  <div style="font-size:10px;">Pendiente</div>
                                </section>
                              </section>

                            <!---------------------------------->

                            <section class="boxCuadro row">
                              <div class="cuadrado"  style="background:#2a8cff;">
                                  <img src="imagenes/aprobado.png">
                              </div>

                              <section class="cuadradoTexto">
                                <div>{{ conAprobado }}</div>
                                <div style="font-size:10px;">Aprobado</div>
                              </section>
                            </section>
                            <!---------------------------------->
                            <section class="boxCuadro row">
                              <div class="cuadrado"  style="background:rgb(238, 109, 105);">
                                  <img src="imagenes/rechazado.png">
                              </div>

                              <section class="cuadradoTexto">
                                <div>{{ conRechazado }}</div>
                                <div style="font-size:10px;">Rechazado</div>
                              </section>
                            </section>

                            <!---------------------------------->
                            <section class="boxCuadro row">
                              <div class="cuadrado" style="background:rgb(3, 215, 5);">
                                  <img src="imagenes/transito.png">
                              </div>

                              <section class="cuadradoTexto">
                                <div>{{ conTransito }}</div>
                                <div style="font-size:10px;">En tránsito</div>
                              </section>
                            </section>

                            <!---------------------------------->
                            <section class="boxCuadro row">
                              <div class="cuadrado" style="background:rgb(69, 175, 121);">
                                  <img src="imagenes/finalizado.png">
                              </div>

                              <section class="cuadradoTexto">
                                <div>{{ conFinalizado }}</div>
                                <div style="font-size:10px;">En proceso</div>
                              </section>
                            </section>

                          </section>

                          <br><br>



                       <table class="table table-hover">
                           <tr>
                              <th></th>
                              <th style="width:5px;"></th>
                               <th style="text-align:center;">Orden</th>
                               <th style="width:150px;">Fecha</th>
                               <th style="text-align:center;">Destino</th>
                               <th style="text-align:center;">Estado</th>
                               <th style="text-align:center;"></th>

                           </tr>

                           {{ form_start(formularioEstado) }}
                           {% for orden in ordenes %}

                               {% set f = orden.fecha.date | split(" ") %}

                               {% set estado = "..." %}

                            {% if orden.estado == 0 %}
                              {% set estado = "En proceso" %}
                              {% set btn = "light" %}
                              {% set imp = "impNeg" %}

                            {% elseif orden.estado == 1 %}
                              {% set btn = "danger" %}
                              {% set estado = "Pendiente" %}
                              {% set imp = "impNeg" %}

                            {% elseif orden.estado == 2 %}
                              {% set estado = "Aprobado" %}
                              {% set btn = "primary" %}
                              {% set imp = "imp" %}

                            {% elseif orden.estado == 3 %}
                              {% set estado = "Rechazado" %}
                              {% set btn = "danger" %}
                              {% set imp = "impNeg" %}

                            {% elseif orden.estado == 4 %}
                              {% set estado = "En tránsito" %}
                              {% set btn = "warning" %}
                              {% set imp = "imp" %}

                            {% elseif orden.estado == 5 %}
                              {% set estado = "Finalizado" %}
                              {% set btn = "success" %}
                              {% set imp = "impNeg" %}

                            {% elseif orden.estado == 6 %}
                              {% set estado = "En espera" %}
                              {% set btn = "secondary" %}
                              {% set imp = "impNeg" %}

                               {% endif %}

                               <tr>

                                   <td style=" width:50px;">
                                      <img src="/imagenes/ojo.png"  id="{{ orden.id }}" class="detalle" title="Ver detalle">

                                   </td>

                                   <td style=" width:50px;">
                                     <a href="/imprimir/{{orden.id}}"  target="_blank">
                                       <img src="/imagenes/impresora.png"  id="{{ orden.id }}" class="{{imp}}" title="Imprimir Nota">
                                     </a>
                                   </td>

                                   <td style="text-align:center; font-weight: bold;">
                                      # {{ orden.id }}
                                    </td>

                                   <td>
                                      {{ f[0]|date("m/d/Y") }}
                                    </td>

                                   <td style="text-align:center;">
                                      {{ orden.destino}}
                                    </td>

                                   <td style="width:120px; text-align:right;">
                                     <span class="badge badge-{{ btn }}">{{ estado }}</span>
                                   </td>

                                   <td>
                                        {{ form_widget(formularioEstado["btnA"~ orden.id]) }}
                                        {{ form_widget(formularioEstado[ "btnB"~ orden.id]) }}
                                   </td>
                               </tr>

                           {% endfor %}
                           {{ form_end(formularioEstado) }}


                       </table>


                     </div>

                     <!-------------------------- tab 3 ---------------------->
                     <div class="tab-pane fade" id="nav-editarList" role="tabpanel" aria-labelledby="nav-editarList-tab">
                     </div>
                 </div>
             </div>

         </div>
     </section>

     <!-- ./Tabs -->

 </div>



{% endblock %}

{% extends 'base.html.twig' %}

{% block title %}{% endblock %}



{% block body %}


    <script>

    $(document).ready(function() {








          /*
          envio del formulario con enter
          */
          $('.serie').keyup(function(e) {

          //  consolelog(e.keyCode );

              if(e.keyCode == 13) {

                var id = $(this).attr("id");
                var numero = id.replace(/\D/g,""); /////elimina cualquier caracter no numerico
                var valor = $("#txt_"+numero).val();

                var idArt = $("#idArt_"+numero).text();
                var art = $("#art_"+numero).text();
                var mar = $("#mar_"+numero).text();
                var mod = $("#mod_"+numero).text();
                var fam = $("#fam_"+numero).text();

                var formulario = "#btn_"+numero;
                $(".nroSerie").val(valor);
                $("#form_idArticulo").val(idArt);
                $("#form_articulo").val(art);
                $("#form_marca").val(mar);
                $("#form_modelo").val(mod);
                $("#form_familia").val(fam);

                $(form_save).click();

                //return false;
              }
          });


          });



    </script>

    {{ form_start(formularioIngreso) }}
    {{  form_widget(formularioIngreso)}}
    {{ form_end(formularioIngreso) }}

    <br>

    {% set fecha = cabecera.fecha.date | split(' ') %}


    <div class="container">


        <br>
        <section id="tabs">

            {% set tipoBTN = "primary" %}

            {% if cabecera.estado == 0 %}
                {% set estado = "En proceso"  %}
                {% set tipoBTN = "light" %}

            {% elseif cabecera.estado == 1 %}
                {% set estado = "Pendiente"  %}
                {% set tipoBTN = "danger" %}

            {% elseif cabecera.estado == 2 %}
                {% set estado = "Aprobado"  %}
                {% set tipoBTN = "primary" %}

            {% elseif cabecera.estado == 3 %}
                {% set estado = "Rechazado"  %}
                {% set tipoBTN = "danger" %}

            {% elseif cabecera.estado == 4 %}
                {% set estado = "En tránsito"  %}
                {% set tipoBTN = "warning" %}

            {% elseif cabecera.estado == 5 %}
                {% set estado = "Finalizado"  %}
                {% set tipoBTN = "success" %}

            {% elseif cabecera.estado == 6 %}
                {% set estado = "En espera"  %}
                {% set tipoBTN = "secondary " %}

            {% endif %}



            {% set act = "" %}

            {% if cabecera.estado == 1 %}
                {% set act = "disabled" %}

            {% elseif cabecera. estado == 2 %}
                {% set act = "disabled" %}
            {% endif %}




            {% set fecha = cabecera.fecha.date | split(' ') %}
            <!-- Modal -->
        <div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLabel"> Orden de recepción # {{ orden }} </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">



                  <div class="alert alert-info" role="alert">
                      <br>
                      <h5>Fecha: {{ fecha[0]|date("m/d/Y") }} </h5>
                      <h5 style="float: left;">Preoveedor: {{ cabecera.destino }}</h5>
                      <br><br><br>
                  </div>

                    <table class="table">
                                        <tr>
                                            <th>Artículo</th>
                                            <th>Familia</th>
                                            <th>Marca</th>
                                            <th>Modelo</th>
                                            <th>Nro Serie</th>
                                        </tr>

                    {% for d in lineas %}
                    <tr>
                        <td>{{ d.articulo }}</td>
                        <td>{{ d.familia }}</td>
                        <td>{{ d.marca }}</td>
                        <td>{{ d.modelo }}</td>
                        <td>{{ d.nroSerie }}</td>
                    </tr>
                    {% endfor %}
                </table>


              </div>
              <div class="modal-footer">

                  {{ form_start(formularioOrden) }}
                  {{ form_widget(formularioOrden) }}
                  {{ form_end(formularioOrden) }}
              </div>
            </div>
          </div>
        </div>


            <h6 class="section-title h1" style="float:left;">
                Orden de entrega # {{ orden }}
                <span class="badge badge-{{ tipoBTN }}" style="font-size: 16px; vertical-align:super; ">{{ estado }}</span>
            </h6>

            <!-- Button trigger modal -->
            <button type="button" {{ act }} class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" style="float:right; ">
                Terminar Orden
            </button>


            <br><br><br>


                <br>
            <div class="row">
                <div class="col-lg-12 ">
                    <nav>
                        <!-------------------------- titulos de tabs ---------------------->
                        <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active" id="nav-vistaPrevia-tab" data-toggle="tab" href="#nav-vistaPrevia" role="tab" aria-controls="nav-vistaPrevia" aria-selected="true">Artículos</a>
                            <a class="nav-item nav-link" id="nav-cabecera-tab" data-toggle="tab" href="#nav-cabecera" role="tab" aria-controls="nav-cabecera" aria-selected="false">Agregar artículos</a>
                            <a class="nav-item nav-link" id="nav-editarList-tab" data-toggle="tab" href="#nav-editarList" role="tab" aria-controls="nav-editarList" aria-selected="false">Modificar lista cabecera</a>
                        </div>
                    </nav>

                    <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">

                        <!-------------------------- tab 1 ---------------------->
                        <div class="tab-pane fade show active" id="nav-vistaPrevia" role="tabpanel" aria-labelledby="nav-vistaPrevia-tab">
                          <div class="alert alert-info" role="alert">
                              Quitar
                          </div>

                          <table class="table">
                              <tr>
                                  <th>Artículo</th>
                                  <th>Marca</th>
                                  <th>Modelo</th>
                                  <th>Nro Serie</th>
                              </tr>
                              {{ form_start(formPedido) }}

                              {% for linea in lineas %}
                                  <tr>
                                      <td>{{ linea.articulo }}</td>
                                      <td>{{ linea.marca }}</td>
                                      <td>{{ linea.modelo }}</td>
                                      <td>{{ linea.nroSerie }}</td>
                                      <td>{{ form_row(formPedido[linea.id]) }}</td>
                                  </tr>
                              {% endfor %}
                          </table>{{ form_end(formPedido) }}
                        </div>

                        <!-------------------------- tab 2 ---------------------->
                        <div class="tab-pane fade" id="nav-cabecera" role="tabpanel" aria-labelledby="nav-cabecera-tab">



                            <div class="alert alert-info" role="alert">
                              <br>
                                Lista de los artículos a entregar
                              <br>
                            </div>


                            <table class="table">
                                <tr>
                                    <th>#</th>
                                    <th>Artículo</th>
                                    <th>Familia</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Nro de serie</th>
                                    <th style="width:100px;"></th>
                                </tr>

                                {% for datos in listaArticulo %}
                                    <tr>
                                        <td id="idArt_{{loop.index0}}"><b>{{ datos.id }}</b></td>
                                        <td id="art_{{loop.index0}}">{{ datos.articulo }}</td>
                                        <td id="fam_{{loop.index0}}">{{ datos.familia }}</td>
                                        <td id="mar_{{loop.index0}}">{{ datos.marca }}</td>
                                        <td id="mod_{{loop.index0}}">{{ datos.modelo }}</td>
                                        <td style="width:150px;">


                                            <input type="text" id="txt_{{loop.index0}}" class="serie" >
                                        </td>
                                        <td>
                                          <button id="btn_{{loop.index0}}" class="boton">click!</button>
                                        </td>

                                      <!-- <td><img src="/imagenes/codRojo.png"></td>  -->
                                    </tr>
                                {% endfor %}
                            </table>

                        </div>

                        <!-------------------------- tab 3 ---------------------->
                        <div class="tab-pane fade" id="nav-editarList" role="tabpanel" aria-labelledby="nav-editarList-tab">
                            {{ form_start(editarCabecera) }}
                            {{ form_widget(editarCabecera )}}
                            {{ form_end(editarCabecera) }}
                        </div>

                    </div>
                </div>

            </div>
        </section>

        <!-- ./Tabs -->

    </div>



{% endblock %}
